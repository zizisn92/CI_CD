docker-build-api:
  stage: docker-build-api
  extends:
    - .image-docker-with-bash
  rules:
    - if: '$CI_COMMIT_BRANCH != "dev"'
      when: never
    - if: '$CI_COMMIT_MESSAGE !~ /(\[api\])/'
      when: never
    - when: always
  script:
    - chmod -R 777 $API_PATH
    - cd $API_PATH
    - git config --global http.sslVerify false
    - git clone https://gitlab-ci-token:${CI_JOB_TOKEN}@git.dttt.vn/gitadmin/gitlabutils
    - cd ..
    - cp $API_PATH/gitlabutils/gitlab-environment/* $API_PATH
    - cd $API_PATH
    - ls
    - "bash deploy.api.ci -s $MODULE_NAME_PASCAL_CASE -e $CI_COMMIT_BRANCH -scope business -imageSuffix .api -tagOnly false -b $TARGET_ENVIRONMENT_BUILD"